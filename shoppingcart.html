<!DOCTYPE html>
<html lang="es">
<head>

    <link rel="shortcut icon" href="Glace_logo.png" type="image/x-icon">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="shopingcart.css">
    <script src="app.js" async></script>
    <title>Order | </title>
</head>
<body>
    <header>
        <h1>Pick Your Item</h1>
    </header>
    <section class="contenedor">
        <!-- Contenedor de elementos -->
        <div class="contenedor-items">
            <div class="item">
                <span class="titulo-item">Vanilla Ice Cream</span>
                <img src="images/menu1.png" alt="" class="img-item">
                <span class="precio-item">8.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Strawberry Ice Cream</span>
                <img src="images/menu2.png" alt="" class="img-item">
                <span class="precio-item">8.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Chocolate Ice Cream</span>
                <img src="images/menu3.png" alt="" class="img-item">
                <span class="precio-item">8.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Greentea Ice Cream</span>
                <img src="images/greentea.png" alt="" class="img-item-2">
                <style> </style>
                <span class="precio-item">8.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Lemon Tea</span>
                <img src="images/lemontea.png" alt="" class="img-item">
                <span class="precio-item">15.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Milkshake Chocolate</span>
                <img src="images/Milkshake_chocolate.png" alt="" class="img-item-3">
                <span class="precio-item">15.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Milkshake Strawberry</span>
                <img src="images/Milkshake_strawberry.png" alt="" class="img-item-4">
                <span class="precio-item">15.000</span>
                <button class="boton-item">Add</button>
            </div>
            <div class="item">
                <span class="titulo-item">Milkshake Vanilla</span>
                <img src="images/Milkshake_vanilla.png" alt="" class="img-item-5">
                <span class="precio-item">15.000</span>
                <button class="boton-item">Add</button>
            </div>
            
        </div>
        <!-- Carrito de Compras -->
        <div class="carrito" id="carrito">
            <div class="header-carrito">
                <h2>Shopping Cart</h2>
            </div>

            <div class="carrito-items">
                <?php
                session_start();
                @mysql_connect("localhost","root","") or die("Could not connect to database");
                @mysql_select_db("bookstore") or die("Could not select database");
                include("admin/php/myFunctions.php");
                
                if(!empty($_GET['prodid'])){
                    $pid = $_GET['prodid'];
                    $wasFound = false;
                    $i = 0;
                    if(!isset($_SESSION["cart_array"]) || count($_SESSION["cart_array"]) < 1){
                        $_SESSION["cart_array"]=array(0=>array("productID"=>$pid,"quantity"=>1));
                    }else{
                        foreach($_SESSION["cart_array"] as $each_product){
                            $i++;
                            while(list($key,$value)=each($each_product)){
                                if($key=="productID" && $value==$pid){  
                                    array_splice($_SESSION["cart_array"],$i-1,1,array(array("productID"=>$pid,"quantity"=>$each_product ['quantity']+1)));
                                    $wasFound=true;
                                }
                            }       
                        }
                        if($wasFound==false){
                            array_push($_SESSION["cart_array"],array("productID"=>$pid,"quantity"=>1));
                        }
                    }
                    header("location:shoppingcart.php");
                    exit();
                }
                //-------------------------------------------------------------------------------------------------
                $submit = $_POST['btnUpdate'];
                if($submit == "Update"){
                    $x = 0;
                
                    foreach($_SESSION["cart_array"] as $each_product){
                        @$i++;
                        $quantity = $_POST['txtQuan'.$x];
                        $prodStock = $_POST['txtHoldQuan'.$x];
                        $prodAdjustId = $_POST['txtHoldProdId'.$x++];
                        if($quantity<1){ $quantity = 1; }
                        if($quantity>$prodStock){ $quantity = $prodStock; }
                        while(list($key,$value)=each($each_product)){
                            array_splice($_SESSION["cart_array"],$i-1,1,array(array("productID"=>$prodAdjustId,"quantity"=>$quantity)));
                        }       
                    }
                
                
                }
                //-------------------------------------------------------------------------------------------------
                if(!empty($_GET['cid']) || isset($_GET['cid'])){
                    $removeKey = $_GET['cid'];
                    if(count($_SESSION["cart_array"])<=1){
                        unset($_SESSION["cart_array"]);
                    }else{
                        unset($_SESSION["cart_array"]["$removeKey"]);
                        sort($_SESSION["cart_array"]);
                    }
                }
                //-------------------------------------------------------------------------------------------------
                $cartTitle = "";
                $cartOutput = "";
                $cartTotal = "";
                if(!isset($_SESSION["cart_array"]) || count($_SESSION["cart_array"]) < 1){
                    $cartOutput="<h2 align='center'> Your shopping cart is empty </h2>";
                }else{
                    $x = 0;
                    $cartTitle .= '<form name="shoppingcart_form" action="shoppingcart.php" method="post" /><table width="700px" cellspacing="0" cellpadding="5">
                            <tr bgcolor="#CCCCCC">
                                        <th width="220" align="left">Image </th> 
                                        <th width="140" align="left">Name </th> 
                                        <th width="100" align="center">Quantity </th> 
                                        <th width="60" align="center">Stock </th> 
                                        <th width="60" align="right">Price </th> 
                                        <th width="60" align="right">Total </th> 
                                        <th width="90"> </th></tr>';
                    $i = 0;
                    foreach($_SESSION["cart_array"] as $each_product){
                        $product_id = $each_product['productID'];
                        $sql=mysql_query("select * from tblproduct where prod_id='$product_id' limit 1");
                        while($row=mysql_fetch_array($sql)){
                            $prodNo = $row["prod_no"];
                            $prodID = $row["prod_id"];
                            $prodName = $row["prod_name"];
                            $prodPrice = $row["prod_price"];
                            $prodQuan = $row["prod_quan"];
                        }
                        $pricetotal=$prodPrice*$each_product['quantity'];
                        $cartTotal= number_format($pricetotal+$cartTotal,2);
                        $cartOutput .= '<tr><td><img style="border: 2px solid;" src="images/product/'.$prodNo.'.jpg" width="150" height="120" /></td> 
                            <td>'.$prodName.'</td> 
                            <td align="center"><input type="hidden" name="txtHoldProdId'.$i.'" value="'.$prodID.'" /><input name="txtQuan'.$i.'" type="text" value="'.$each_product['quantity'].'" style="width: 40px; text-align: center" /> </td>
                            <td align="center"><input type="hidden" name="txtHoldQuan'.$i.'" value="'.$prodQuan.'" /> '.$prodQuan   .' pcs</td> 
                            <td align="right">R '.$prodPrice.'</td> 
                            <td align="right">R '.$pricetotal.'</td>
                            <td align="center"> <a href="shoppingcart.php?cid='.$i++.'"><img src="images/remove_x.gif" alt="remove" /><br />Remove</a> </td></tr>';
                    }
                    $_SESSION['checkoutCartTotal'] = $cartTotal;
                    $cartOutput .= '<tr>
                                        <td colspan="3" align="right"  height="40px">Have you modified your basket? Please click here to <input class="btn_upd" type="submit" name="btnUpdate" value="Update" />&nbsp;&nbsp;</td>
                                        <td align="right" style="background:#ccc; font-weight:bold"> Total: </td>
                                        <td colspan="2" align="left" style="background:#ccc; font-weight:bold;">R '.$cartTotal.' </td>
                                        <td style="background:#ccc; font-weight:bold"> </td>
                                    </tr>
                                </table>
                                <div style="float:right; width: 215px; margin-top: 20px;">
                
                                    <div class="checkout"><a href="checkout.php" class="more">Proceed to Checkout</a></div>
                
                                </div></form>';
                ?>
                <!-- 
                <div class="carrito-item">
                    <img src="img/boxengasse.png" width="80px" alt="">
                    <div class="carrito-item-detalles">
                        <span class="carrito-item-titulo">Box Engasse</span>
                        <div class="selector-cantidad">
                            <i class="fa-solid fa-minus restar-cantidad"></i>
                            <input type="text" value="1" class="carrito-item-cantidad" disabled>
                            <i class="fa-solid fa-plus sumar-cantidad"></i>
                        </div>
                        <span class="carrito-item-precio">$15.000,00</span>
                    </div>
                   <span class="btn-eliminar">
                        <i class="fa-solid fa-trash"></i>
                   </span>
                </div>
                <div class="carrito-item">
                    <img src="img/skinglam.png" width="80px" alt="">
                    <div class="carrito-item-detalles">
                        <span class="carrito-item-titulo">Skin Glam</span>
                        <div class="selector-cantidad">
                            <i class="fa-solid fa-minus restar-cantidad"></i>
                            <input type="text" value="3" class="carrito-item-cantidad" disabled>
                            <i class="fa-solid fa-plus sumar-cantidad"></i>
                        </div>
                        <span class="carrito-item-precio">$18.000,00</span>
                    </div>
                   <button class="btn-eliminar">
                        <i class="fa-solid fa-trash"></i>
                   </button>
                </div>
                 -->
            </div>
            <form action="connect.php" method="post">
            <div class="carrito-total">
                <div class="fila">
                    <strong>Total</strong>
                    <span class="carrito-precio-total">
                        Rp.120.000,00
                    </span>
                </div>
                <button type="submit" class="btn-pagar" value="Submit">Checkout <i class="fa-solid fa-bag-shopping"></i> </button>
            </div>
            </form>
        </div>
    </section>
</body>
</html>